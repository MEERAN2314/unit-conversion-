{% extends "base.html" %}

{% block title %}Unit Converter Pro - Professional Unit Conversion{% endblock %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-lg-10">
        <!-- Hero Section -->
        <div class="text-center mb-5">
            <h1 class="display-4 gradient-text mb-4">
                <i class="fas fa-exchange-alt me-3"></i>Unit Converter Pro
            </h1>
            <p class="lead text-muted mb-4">
                Convert between different units of measurement with precision, accuracy, and professional styling
            </p>
            <div class="d-flex justify-content-center gap-3 mb-4">
                <span class="badge bg-primary fs-6 px-3 py-2">
                    <i class="fas fa-ruler me-1"></i>Length
                </span>
                <span class="badge bg-primary fs-6 px-3 py-2">
                    <i class="fas fa-thermometer-half me-1"></i>Temperature
                </span>
                <span class="badge bg-primary fs-6 px-3 py-2">
                    <i class="fas fa-tachometer-alt me-1"></i>Pressure
                </span>
                <span class="badge bg-primary fs-6 px-3 py-2">
                    <i class="fas fa-bolt me-1"></i>Electrical
                </span>
            </div>
        </div>

        <!-- Main Conversion Form -->
        <div class="card shadow-lg pulse-blue mb-5">
            <div class="card-header">
                <h3 class="card-title mb-0">
                    <i class="fas fa-calculator me-2"></i>Professional Unit Conversion
                </h3>
            </div>
            <div class="card-body p-4">
                <form method="POST" action="/convert" id="conversionForm">
                    <div class="row">
                        <!-- Value Input -->
                        <div class="col-md-6 mb-4">
                            <label for="value" class="form-label">
                                <i class="fas fa-hashtag me-2"></i>Value to Convert
                            </label>
                            <input type="number" 
                                   class="form-control form-control-lg" 
                                   id="value" 
                                   name="value" 
                                   step="any" 
                                   placeholder="Enter a number (e.g., 205)" 
                                   required>
                            <div class="form-text">
                                <i class="fas fa-info-circle me-1"></i>
                                Enter any numeric value including decimals
                            </div>
                        </div>

                        <!-- From Unit Selection -->
                        <div class="col-md-6 mb-4">
                            <label for="from_unit" class="form-label">
                                <i class="fas fa-arrow-right me-2"></i>From Unit
                            </label>
                            <select class="form-select form-select-lg" id="from_unit" name="from_unit" required>
                                <option value="">Select source unit...</option>
                                {% for category, units in units_by_category.items() %}
                                    <optgroup label="{{ category.title() }} Units">
                                        {% for unit in units %}
                                            <option value="{{ unit.symbol }}" 
                                                    data-category="{{ category }}"
                                                    title="{{ unit.notes if unit.notes else unit.name }}">
                                                {{ unit.symbol }} - {{ unit.name }}
                                            </option>
                                        {% endfor %}
                                    </optgroup>
                                {% endfor %}
                            </select>
                        </div>
                    </div>

                    <!-- To Units Selection -->
                    <div class="mb-4">
                        <label class="form-label">
                            <i class="fas fa-arrow-left me-2"></i>Target Units (Optional)
                        </label>
                        <div class="alert alert-info border-0" style="background: linear-gradient(135deg, #dbeafe 0%, #ffffff 100%);">
                            <i class="fas fa-lightbulb me-2"></i>
                            <strong>Pro Tip:</strong> Select specific units to convert to, or leave empty to convert to all compatible units automatically
                        </div>
                        
                        <div id="target-units-container">
                            {% for category, units in units_by_category.items() %}
                                <div class="unit-category p-4 mb-4" data-category="{{ category }}" style="display: none;">
                                    <h6 class="fw-bold text-primary mb-3">
                                        <i class="fas fa-layer-group me-2"></i>{{ category.title() }} Units
                                    </h6>
                                    <div class="row g-3">
                                        {% for unit in units %}
                                            <div class="col-md-6 col-lg-4">
                                                <div class="form-check p-3 border rounded-3 h-100" style="border-color: var(--border-blue) !important;">
                                                    <input class="form-check-input" 
                                                           type="checkbox" 
                                                           name="to_units" 
                                                           value="{{ unit.symbol }}" 
                                                           id="to_{{ unit.symbol }}"
                                                           data-category="{{ category }}">
                                                    <label class="form-check-label w-100" for="to_{{ unit.symbol }}">
                                                        <div class="d-flex align-items-center">
                                                            <strong class="text-primary">{{ unit.symbol }}</strong>
                                                            <span class="ms-2 text-muted">{{ unit.name }}</span>
                                                        </div>
                                                        {% if unit.notes %}
                                                            <small class="text-muted d-block mt-1">
                                                                <i class="fas fa-info-circle me-1"></i>{{ unit.notes }}
                                                            </small>
                                                        {% endif %}
                                                    </label>
                                                </div>
                                            </div>
                                        {% endfor %}
                                    </div>
                                </div>
                            {% endfor %}
                        </div>
                    </div>

                    <!-- Submit Button -->
                    <div class="d-grid">
                        <button type="submit" class="btn btn-primary btn-lg">
                            <i class="fas fa-sync-alt me-2"></i>Convert Units
                            <i class="fas fa-arrow-right ms-2"></i>
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Quick Examples Section -->
        <div class="card mb-5">
            <div class="card-header">
                <h5 class="card-title mb-0">
                    <i class="fas fa-rocket me-2"></i>Quick Start Examples
                </h5>
            </div>
            <div class="card-body">
                <div class="row g-4">
                    <div class="col-md-4">
                        <div class="unit-card card h-100 border-primary" onclick="setExample(205, 'mm', ['m', 'cm', 'in', 'ft'])">
                            <div class="card-body text-center p-4">
                                <div class="feature-icon">
                                    <i class="fas fa-ruler text-primary"></i>
                                </div>
                                <h6 class="fw-bold">Length Conversion</h6>
                                <p class="text-muted mb-3">Convert 205 mm to meters, centimeters, inches, and feet</p>
                                <div class="badge bg-light text-primary">
                                    205 mm → Multiple Units
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="unit-card card h-100 border-warning" onclick="setExample(25, 'DEG_C', ['DEG_F'])">
                            <div class="card-body text-center p-4">
                                <div class="feature-icon">
                                    <i class="fas fa-thermometer-half text-warning"></i>
                                </div>
                                <h6 class="fw-bold">Temperature</h6>
                                <p class="text-muted mb-3">Convert 25°C to Fahrenheit with precise formula</p>
                                <div class="badge bg-light text-warning">
                                    25°C → 77°F
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="unit-card card h-100 border-success" onclick="setExample(12, 'in', ['ft', 'cm', 'm'])">
                            <div class="card-body text-center p-4">
                                <div class="feature-icon">
                                    <i class="fas fa-arrows-alt text-success"></i>
                                </div>
                                <h6 class="fw-bold">Imperial to Metric</h6>
                                <p class="text-muted mb-3">Convert 12 inches to feet, centimeters, and meters</p>
                                <div class="badge bg-light text-success">
                                    12 in → Metric Units
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Features Section -->
        <div class="row g-4 mb-5">
            <div class="col-md-3">
                <div class="text-center p-4">
                    <div class="feature-icon">
                        <i class="fas fa-bolt text-primary"></i>
                    </div>
                    <h6 class="fw-bold">Lightning Fast</h6>
                    <p class="text-muted small">Instant conversions with high precision calculations</p>
                </div>
            </div>
            <div class="col-md-3">
                <div class="text-center p-4">
                    <div class="feature-icon">
                        <i class="fas fa-shield-alt text-primary"></i>
                    </div>
                    <h6 class="fw-bold">Accurate</h6>
                    <p class="text-muted small">Precise formulas ensure reliable results every time</p>
                </div>
            </div>
            <div class="col-md-3">
                <div class="text-center p-4">
                    <div class="feature-icon">
                        <i class="fas fa-mobile-alt text-primary"></i>
                    </div>
                    <h6 class="fw-bold">Responsive</h6>
                    <p class="text-muted small">Works perfectly on desktop, tablet, and mobile devices</p>
                </div>
            </div>
            <div class="col-md-3">
                <div class="text-center p-4">
                    <div class="feature-icon">
                        <i class="fas fa-code text-primary"></i>
                    </div>
                    <h6 class="fw-bold">API Ready</h6>
                    <p class="text-muted small">Full REST API with interactive documentation</p>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    // Enhanced JavaScript for better UX
    document.addEventListener('DOMContentLoaded', function() {
        // Add loading state to form submission
        const form = document.getElementById('conversionForm');
        const submitBtn = form.querySelector('button[type="submit"]');
        const originalBtnText = submitBtn.innerHTML;
        
        form.addEventListener('submit', function() {
            submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Converting...';
            submitBtn.disabled = true;
        });
    });

    // Filter target units based on selected source unit category
    document.getElementById('from_unit').addEventListener('change', function() {
        const selectedOption = this.options[this.selectedIndex];
        const selectedCategory = selectedOption.getAttribute('data-category');
        
        // Show/hide unit categories with animation
        const categories = document.querySelectorAll('[data-category]');
        categories.forEach(function(element) {
            if (element.classList.contains('unit-category')) {
                if (selectedCategory && element.getAttribute('data-category') === selectedCategory) {
                    element.style.display = 'block';
                    element.style.animation = 'fadeIn 0.5s ease-out';
                } else {
                    element.style.display = 'none';
                }
            }
        });
        
        // Uncheck all target units when source changes
        const checkboxes = document.querySelectorAll('input[name="to_units"]');
        checkboxes.forEach(function(checkbox) {
            checkbox.checked = false;
        });
    });

    // Set example values with smooth animation
    function setExample(value, fromUnit, toUnits) {
        // Add visual feedback
        const valueInput = document.getElementById('value');
        const fromUnitSelect = document.getElementById('from_unit');
        
        // Animate value input
        valueInput.style.transform = 'scale(1.05)';
        valueInput.style.transition = 'transform 0.2s ease';
        setTimeout(() => {
            valueInput.style.transform = 'scale(1)';
        }, 200);
        
        valueInput.value = value;
        fromUnitSelect.value = fromUnit;
        
        // Trigger change event to show correct category
        fromUnitSelect.dispatchEvent(new Event('change'));
        
        // Check the target units with delay for better UX
        setTimeout(function() {
            toUnits.forEach(function(unit, index) {
                setTimeout(function() {
                    const checkbox = document.getElementById('to_' + unit);
                    if (checkbox) {
                        checkbox.checked = true;
                        // Add visual feedback
                        checkbox.parentElement.style.transform = 'scale(1.05)';
                        checkbox.parentElement.style.transition = 'transform 0.2s ease';
                        setTimeout(() => {
                            checkbox.parentElement.style.transform = 'scale(1)';
                        }, 200);
                    }
                }, index * 100); // Stagger the animations
            });
        }, 300);
        
        // Scroll to form smoothly
        document.getElementById('conversionForm').scrollIntoView({
            behavior: 'smooth',
            block: 'center'
        });
    }

    // Add hover effects to form elements
    const formElements = document.querySelectorAll('.form-control, .form-select');
    formElements.forEach(element => {
        element.addEventListener('mouseenter', function() {
            this.style.transform = 'translateY(-1px)';
        });
        
        element.addEventListener('mouseleave', function() {
            if (this !== document.activeElement) {
                this.style.transform = 'translateY(0)';
            }
        });
    });

    // Auto-save form data to localStorage
    function saveFormData() {
        const formData = {
            value: document.getElementById('value').value,
            from_unit: document.getElementById('from_unit').value,
            to_units: Array.from(document.querySelectorAll('input[name="to_units"]:checked')).map(cb => cb.value)
        };
        localStorage.setItem('unitConverterFormData', JSON.stringify(formData));
    }

    // Restore form data from localStorage
    function restoreFormData() {
        const savedData = localStorage.getItem('unitConverterFormData');
        if (savedData) {
            try {
                const data = JSON.parse(savedData);
                if (data.value) document.getElementById('value').value = data.value;
                if (data.from_unit) {
                    document.getElementById('from_unit').value = data.from_unit;
                    document.getElementById('from_unit').dispatchEvent(new Event('change'));
                }
                if (data.to_units && data.to_units.length > 0) {
                    setTimeout(() => {
                        data.to_units.forEach(unit => {
                            const checkbox = document.getElementById('to_' + unit);
                            if (checkbox) checkbox.checked = true;
                        });
                    }, 100);
                }
            } catch (error) {
                console.error('Error restoring form data:', error);
            }
        }
    }

    // Save form data on input changes
    document.addEventListener('input', saveFormData);
    document.addEventListener('change', saveFormData);

    // Restore form data on page load
    restoreFormData();
</script>
{% endblock %}